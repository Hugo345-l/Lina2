# Roadmap Detalhado - Projeto Lina v2.0
*Assistente Pessoal Multi-Agente com Arquitetura de Grafo Observ√°vel*

## üìã Vis√£o Geral da Refatora√ß√£o

**Status**: Refatora√ß√£o Profunda em Andamento  
**Foco**: Backend First, Grafo Robusto, Observabilidade Total  
**UI Inicial**: LangGraph Studio (nativo)  
**Tecnologias Core**: LangGraph + LangChain + OpenRouter + SQLite

---

## ‚öôÔ∏è **FASE SETUP: Configura√ß√£o do Ambiente LangGraph Studio** (1 dia)

### **Objetivo**
Configurar e validar o ambiente de desenvolvimento com LangGraph CLI e Studio antes de iniciar a implementa√ß√£o.

### **Tarefa SETUP.1: Instala√ß√£o e Configura√ß√£o Base**

#### **Instala√ß√£o do LangGraph CLI**
- [x] Instalar LangGraph CLI com suporte in-memory:
  ```bash
  pip install "langgraph-cli[inmem]>=0.1.55"
  ```
- [x] Verificar instala√ß√£o:
  ```bash
  langgraph --help
  ```
- [x] Configurar conta LangSmith (necess√°ria para LangGraph Studio):
  - [x] Criar conta em https://smith.langchain.com
  - [x] Gerar API key no LangSmith
  - [x] Configurar vari√°vel de ambiente `LANGSMITH_API_KEY`

#### **Configura√ß√£o do Projeto Teste**
- [x] Criar estrutura m√≠nima de projeto:
  ```
  lina-setup-test/
  ‚îú‚îÄ‚îÄ simple_agent.py
  ‚îú‚îÄ‚îÄ langgraph.json
  ‚îú‚îÄ‚îÄ requirements.txt
  ‚îî‚îÄ‚îÄ .env
  ```
- [x] Implementar grafo m√≠nimo funcional em `simple_agent.py`:
  - [x] Estado simples com mensagens
  - [x] N√≥ √∫nico que responde "Hello from LangGraph!"
  - [x] Compila√ß√£o do grafo
- [x] Criar `langgraph.json` b√°sico:
  ```json
  {
    "dependencies": ["."],
    "graphs": {
      "test_agent": "./simple_agent.py:graph"
    },
    "env": ".env"
  }
  ```
- [x] Configurar `.env` com:
  ```
  LANGSMITH_API_KEY=sua_api_key_aqui
  ```

### **Tarefa SETUP.2: Valida√ß√£o do LangGraph Studio**

#### **Teste do Servidor Local**
- [x] Executar servidor de desenvolvimento com `langgraph dev`.
- [x] Executar servidor de desenvolvimento com `langgraph up` (usando Docker).
- [x] Verificar se ambos os servidores iniciam corretamente.
- [x] Confirmar que o grafo √© carregado sem erros em ambas as abordagens.

#### **Teste do LangGraph Studio Web**
- [x] Acessar LangGraph Studio e conectar aos servidores locais.
- [x] Fazer login com conta LangSmith.
- [x] Verificar se o grafo aparece na interface.
- [x] Testar execu√ß√£o do grafo.

### **Tarefa SETUP.3: Explora√ß√£o das Funcionalidades**

#### **Teste de Funcionalidades Core**
- [x] **Visualiza√ß√£o**: Confirmado que o grafo aparece visualmente.
- [x] **Execu√ß√£o**: Confirmado, com inputs de teste e verifica√ß√£o de outputs.
- [x] **Debug**: Funcionalidades de interrup√ß√£o e passo-a-passo validadas.
- [x] **Estado**: Inspe√ß√£o de estado entre n√≥s validada.
- [x] **Threading**: Cria√ß√£o e altern√¢ncia entre threads validada.
- [x] **Configura√ß√£o**: Edi√ß√£o de configura√ß√µes validada.

### **Tarefa SETUP.4: Documenta√ß√£o e Prepara√ß√£o**

#### **Documenta√ß√£o dos Achados**
- [x] Criar `SETUP_NOTES.md` documentando:
  - [x] Processo de instala√ß√£o e configura√ß√£o
  - [x] Estrutura m√≠nima necess√°ria do projeto
  - [x] Funcionalidades dispon√≠veis no Studio
  - [x] Limita√ß√µes identificadas
  - [x] Diferen√ßas entre `langgraph dev` vs `langgraph up`
  - [x] Best practices para desenvolvimento

### **Crit√©rios de Sucesso**
- [x] LangGraph CLI instalado e funcionando.
- [x] Servidor local (`dev` e `up`) iniciando sem erros.
- [x] LangGraph Studio acess√≠vel e funcional.
- [x] Grafo de teste executando corretamente.
- [x] Todas as funcionalidades core validadivas.
- [x] Documenta√ß√£o completa do setup.
- [x] Ambiente pronto para desenvolvimento do projeto principal.


---

## üéØ **FASE 0: Prepara√ß√£o e Aprendizado** (2-3 dias)

### **Objetivo**
Entender profundamente LangGraph e validar conceitos antes de implementar.

### **Tarefa 0.1: Estudo Dirigido do LangGraph**
- [x] Estudar exemplos oficiais:
  - [x] [Multi-agent supervisor pattern](https://github.com/langchain-ai/langgraph/tree/main/examples/multi_agent)
  - [x] [ReAct agent implementation](https://github.com/langchain-ai/langgraph/tree/main/examples/react)
  - [x] [Human-in-the-loop patterns](https://github.com/langchain-ai/langgraph/tree/main/examples/human_in_the_loop)
- [x] Entender sistema de checkpoints e recupera√ß√£o de estado
- [x] Explorar capacidades do LangGraph Studio
- [x] Documentar insights e padr√µes √∫teis

### **Tarefa 0.2: Prototipagem Conceitual**
- [ ] Criar `experiments/grafo_conceitual.py` com:
  - [ ] Grafo m√≠nimo com 3 n√≥s (Front, Memory, Tools)
  - [ ] Estado compartilhado simples
  - [ ] Roteamento b√°sico entre n√≥s
  - [ ] Logging detalhado de execu√ß√£o
- [ ] Validar no LangGraph Studio:
  - [ ] Visualiza√ß√£o do grafo
  - [ ] Inspe√ß√£o de estados
  - [ ] Timeline de execu√ß√£o
- [ ] Documentar aprendizados em `experiments/LEARNINGS.md`

---

## üèóÔ∏è **FASE 1: Funda√ß√£o do Grafo Multi-Agente** (1 semana)

### **Objetivo**
Construir a estrutura base do grafo com as tr√™s inst√¢ncias como conjuntos de n√≥s especializados.

### **Tarefa 1.1: Arquitetura Base do Grafo**

#### **Implementa√ß√£o do Estado Unificado**
```python
# lina-backend/core/state.py
class LinaState(TypedDict):
    # Estados compartilhados
    messages: List[BaseMessage]
    current_user_intent: Dict
    thread_id: str
    user_id: str
    
    # Estados espec√≠ficos
    front_context: Dict
    memory_context: Dict
    tool_context: Dict
    
    # Observabilidade
    execution_path: List[str]
    decisions: List[Dict]
    node_metrics: Dict[str, Dict]
    total_cost: float
    total_tokens: int
```

#### **Checklist**
- [ ] Criar estrutura de diret√≥rios:
  ```
  lina-backend/
  ‚îú‚îÄ‚îÄ core/
  ‚îÇ   ‚îú‚îÄ‚îÄ state.py
  ‚îÇ   ‚îú‚îÄ‚îÄ nodes/
  ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ supervisor.py
  ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ front/
  ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ memory/
  ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tools/
  ‚îÇ   ‚îî‚îÄ‚îÄ graph.py
  ‚îú‚îÄ‚îÄ mcps/
  ‚îú‚îÄ‚îÄ utils/
  ‚îî‚îÄ‚îÄ main.py
  ```
- [ ] Implementar `LinaState` com tipagem completa
- [ ] Criar sistema de logging estruturado
- [ ] Configurar LangSmith tracing

### **Tarefa 1.2: Supervisor e Roteamento**

#### **Implementa√ß√£o**
- [ ] `supervisor_node`: Analisa intent e roteia
- [ ] Sistema de decis√£o com reasoning expl√≠cito
- [ ] M√∫ltiplos caminhos poss√≠veis:
  - [ ] Fast path (Front only)
  - [ ] Context path (Front ‚Üí Memory ‚Üí Front)
  - [ ] Action path (Front ‚Üí Tools ‚Üí Front)
  - [ ] Full path (Front ‚Üí Memory ‚Üí Tools ‚Üí Front)

#### **Crit√©rios de Decis√£o**
```python
def routing_decision(intent: Dict) -> str:
    """
    Retorna pr√≥ximo n√≥ baseado em:
    - Complexidade da tarefa
    - Necessidade de contexto hist√≥rico
    - Necessidade de a√ß√µes externas
    - Prefer√™ncias do usu√°rio
    """
```

### **Tarefa 1.3: N√≥s da Lina-Front**

#### **N√≥s a Implementar**
- [ ] `front_interpreter`: Extra√ß√£o de intent e entities
- [ ] `quick_responder`: Respostas r√°pidas sem LLM
- [ ] `context_enricher`: Adiciona contexto da conversa atual
- [ ] `response_formatter`: Formata resposta final

#### **Ferramentas do Front**
- [ ] Calculadora simples
- [ ] Conversor de unidades
- [ ] Data/hora atual
- [ ] FAQ est√°tico

### **Tarefa 1.4: N√≥s da Lina-Memory**

#### **N√≥s a Implementar**
- [ ] `memory_searcher`: Busca vetorial em hist√≥rico
- [ ] `pattern_analyzer`: Identifica padr√µes de uso
- [ ] `context_distiller`: Resume contexto relevante
- [ ] `memory_writer`: Salva novas mem√≥rias

#### **Setup Inicial**
- [ ] Configurar FAISS para vector store local
- [ ] Implementar sistema de embeddings
- [ ] Criar √≠ndices b√°sicos

### **Tarefa 1.5: N√≥s da Lina-Tools**

#### **N√≥s a Implementar**
- [ ] `tool_selector`: Escolhe ferramenta apropriada
- [ ] `tool_executor`: Executa via MCP
- [ ] `result_validator`: Valida resultados
- [ ] `progress_reporter`: Reporta progresso de tarefas longas

#### **Prepara√ß√£o para MCPs**
- [ ] Interface abstrata para MCPs
- [ ] Sistema de registro de ferramentas
- [ ] Error handling robusto

### **Tarefa 1.6: Integra√ß√£o e Testes**

#### **Valida√ß√µes**
- [ ] Fluxo Fast Path funcionando
- [ ] Handoffs entre n√≥s sem perda de contexto
- [ ] Estado consistente atrav√©s do fluxo
- [ ] M√©tricas por n√≥ sendo coletadas
- [ ] Visualiza√ß√£o correta no LangGraph Studio

---

## üîß **FASE 2: MCPs Elementares** (1 semana)

### **Objetivo**
Implementar ferramentas b√°sicas que demonstram capacidades de cada inst√¢ncia.

### **Tarefa 2.1: MCP Sistema de Arquivos**

#### **Funcionalidades**
- [ ] Listar arquivos em diret√≥rio
- [ ] Ler conte√∫do de arquivo
- [ ] Criar arquivo com conte√∫do
- [ ] Mover/renomear arquivos
- [ ] Buscar arquivos por padr√£o

#### **Seguran√ßa**
- [ ] Sandbox em diret√≥rio espec√≠fico
- [ ] Valida√ß√£o de paths
- [ ] Limites de tamanho
- [ ] Tipos de arquivo permitidos

### **Tarefa 2.2: MCP Pesquisa Web**

#### **Funcionalidades**
- [ ] Buscar via DuckDuckGo API
- [ ] Extrair conte√∫do de p√°ginas
- [ ] Resumir resultados
- [ ] Cache de resultados

#### **Implementa√ß√£o**
- [ ] Rate limiting
- [ ] User agent apropriado
- [ ] Parsing robusto de HTML

### **Tarefa 2.3: MCP Tempo e Calend√°rio**

#### **Funcionalidades Front (leves)**
- [ ] Data/hora atual
- [ ] Convers√£o de timezones
- [ ] C√°lculos de data simples

#### **Funcionalidades Tools (complexas)**
- [ ] Criar eventos (mock inicial)
- [ ] Listar eventos
- [ ] Verificar disponibilidade

### **Tarefa 2.4: MCP Mem√≥ria Local**

#### **Funcionalidades**
- [ ] Salvar conversa com embeddings
- [ ] Busca por similaridade
- [ ] Estat√≠sticas de uso
- [ ] Exportar/importar mem√≥rias

### **Tarefa 2.5: Integra√ß√£o com Grafo**

#### **Implementa√ß√£o**
- [ ] Registrar MCPs nos n√≥s apropriados
- [ ] Testar fluxos completos com ferramentas
- [ ] Ajustar roteamento baseado em ferramentas dispon√≠veis
- [ ] Validar no LangGraph Studio

---

## üß† **FASE 3: Intelig√™ncia e Observabilidade** (2 semanas)

### **Objetivo**
Adicionar capacidades avan√ßadas de mem√≥ria e melhorar observabilidade.

### **Tarefa 3.1: Sistema de Mem√≥ria Avan√ßado**

#### **Implementa√ß√µes**
- [ ] Mem√≥ria epis√≥dica (conversas completas)
- [ ] Mem√≥ria sem√¢ntica (conceitos e rela√ß√µes)
- [ ] Mem√≥ria procedural (como fazer tarefas)
- [ ] Sistema de esquecimento (relev√¢ncia temporal)

### **Tarefa 3.2: An√°lise de Padr√µes**

#### **Funcionalidades**
- [ ] Identificar hor√°rios preferenciais
- [ ] Detectar tarefas recorrentes
- [ ] Aprender prefer√™ncias impl√≠citas
- [ ] Gerar insights autom√°ticos

### **Tarefa 3.3: Observabilidade Aprimorada**

#### **Implementa√ß√µes**
- [ ] Custom callbacks para LangSmith
- [ ] M√©tricas detalhadas por n√≥:
  - [ ] Lat√™ncia
  - [ ] Tokens usados
  - [ ] Decis√µes tomadas
  - [ ] Confian√ßa nas decis√µes
- [ ] Sistema de replay de execu√ß√µes
- [ ] Exporta√ß√£o de traces para an√°lise

### **Tarefa 3.4: Otimiza√ß√£o de Performance**

#### **Melhorias**
- [ ] Cache inteligente de respostas
- [ ] Pr√©-computa√ß√£o de embeddings
- [ ] Roteamento otimizado por custo
- [ ] Execu√ß√£o paralela onde poss√≠vel

---

## üé® **FASE 4: Interface Customizada** (quando grafo maduro)

### **Objetivo**
Criar interface espec√≠fica para necessidades al√©m do LangGraph Studio.

### **Tarefa 4.1: API de Observabilidade**

#### **Endpoints**
- [ ] `GET /execution/{id}/timeline`
- [ ] `GET /execution/{id}/state/{node}`
- [ ] `GET /execution/{id}/decisions`
- [ ] `GET /threads/{user_id}`
- [ ] `WebSocket /execution/live`

### **Tarefa 4.2: Frontend de Debug Avan√ßado**

#### **Componentes**
- [ ] Timeline vertical interativa
- [ ] Visualiza√ß√£o de grafo (D3.js/Mermaid)
- [ ] Inspetor de estado por n√≥
- [ ] Replay de execu√ß√µes
- [ ] Compara√ß√£o entre execu√ß√µes

### **Tarefa 4.3: Analytics Dashboard**

#### **M√©tricas**
- [ ] Uso por tipo de fluxo
- [ ] Custo por usu√°rio/per√≠odo
- [ ] Taxa de sucesso por tipo de tarefa
- [ ] Padr√µes de uso temporal

---

## üìä **M√©tricas de Valida√ß√£o por Fase**

### **Fase 1 - Funda√ß√£o**
- [ ] Grafo com 10+ n√≥s funcionando
- [ ] 4 tipos de fluxo implementados
- [ ] Estado consistente em todos os fluxos
- [ ] Traces completos no LangSmith

### **Fase 2 - MCPs**
- [ ] 4 MCPs funcionais
- [ ] 20+ opera√ß√µes dispon√≠veis
- [ ] Taxa de sucesso > 95%
- [ ] Documenta√ß√£o completa de cada MCP

### **Fase 3 - Intelig√™ncia**
- [ ] 1000+ mem√≥rias armazenadas em testes
- [ ] Busca sem√¢ntica < 100ms
- [ ] 5+ tipos de padr√µes detectados
- [ ] Redu√ß√£o de 30% no custo via otimiza√ß√£o

### **Fase 4 - Interface**
- [ ] Timeline completa de execu√ß√µes
- [ ] Visualiza√ß√£o de grafo funcional
- [ ] Analytics em tempo real
- [ ] Export de dados para an√°lise

---

## üö´ **Anti-Padr√µes a Evitar**

1. **N√£o come√ßar pela UI** - Backend primeiro!
2. **N√£o criar n√≥s sem observabilidade** - Cada n√≥ deve ser rastre√°vel
3. **N√£o otimizar prematuramente** - Funcionalidade antes de performance
4. **N√£o acoplar n√≥s desnecessariamente** - Manter modularidade
5. **N√£o pular testes no LangGraph Studio** - Validar cada etapa

---

## üìÖ **Timeline Estimada**

- **Dia 1**: Fase SETUP completa
- **Semana 1**: Fase 0 + In√≠cio Fase 1
- **Semana 2**: Conclus√£o Fase 1 + In√≠cio Fase 2
- **Semana 3**: Conclus√£o Fase 2
- **Semanas 4-5**: Fase 3 completa
- **Semana 6+**: Fase 4 (se necess√°rio)

---

## ‚úÖ **Definition of Done**

Cada tarefa s√≥ est√° completa quando:
1. C√≥digo implementado e funcionando
2. Testes escritos e passando
3. Documenta√ß√£o atualizada
4. Validado no LangGraph Studio
5. M√©tricas de observabilidade funcionando
6. Code review (mesmo que self-review) feito

---

*Este roadmap √© um documento vivo e ser√° atualizado conforme aprendemos mais sobre o sistema.*
